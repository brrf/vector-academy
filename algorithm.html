<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Algo</title>
</head>
<body>
	<p>Help</p>
	<script>
		let companies = {
			A: [1, 2, 3, 4],
			B: [2, 3, 4, 1],
			C: [3, 1, 4, 2],
			D: [4, 1, 2, 3],
		};

		let applications = {
			1: ['D', 'C', 'B', 'A'],
			2: ['C', 'B', 'A', 'D'],
			3: ['B', 'A', 'D', 'C'],
			4: ['A', 'D', 'C', 'B']
		};

		let matches = [];

		//if true, will only create match if applicant/company are each other's #1 available choices 
		const topChoiceMode = false;

		function findNextMatch(applicantRankPosition, companyRankPosition) {
			let longestApplicantList = 0;
			let longestCompanyList = 0;

			for (let applicant in applications) {
				if(Object.keys(companies).length === 0 || Object.keys(applications).length === 0) continue	;
				if(!applications[applicant][applicantRankPosition]) continue	;
				const applicantRankListLength = applications[applicant].length;
				const companyRankListLength = companies[applications[applicant][applicantRankPosition]].length;

				if (applicantRankListLength > longestApplicantList) longestApplicantList = applicantRankListLength;
				if (companyRankListLength > longestCompanyList) longestCompanyList = companyRankListLength;

				if (applicantRankPosition >= applicantRankListLength || companyRankPosition >= companyRankListLength) continue;
				if (companies[applications[applicant][applicantRankPosition]][companyRankPosition] === Number(applicant)) {
					return addMatch(applicant, applications[applicant][applicantRankPosition]);
				}
			};
			if (topChoiceMode) return;
			if (applicantRankPosition + 1 < longestApplicantList) {
				applicantRankPosition++;
				findNextMatch(applicantRankPosition, companyRankPosition);			
			} else if (companyRankPosition + 1 < longestCompanyList) {
				applicantRankPosition = 0;
				companyRankPosition++;
				findNextMatch(applicantRankPosition, companyRankPosition)
			} else {
				return;
			}
		};

		function addMatch(matchedApplicant, matchedCompany) {
			//add matched pair to matches array
			matches.push({
				[matchedApplicant]: matchedCompany
			})
			//delete the matched company and applicant from their respective objects
			delete applications[matchedApplicant];
			for (let applicant in applications) {
				applications[applicant] = applications[applicant].filter(company => company !== matchedCompany)
			}
			delete companies[matchedCompany];
			for (let company in companies) {
				companies[company] = companies[company].filter(rankedApplicant => rankedApplicant !== Number(matchedApplicant))
			}
			findNextMatch(0, 0)
		}




		findNextMatch(0, 0);
		console.log(matches);
	</script>
</body>
</html>